# Документация модуля Core

Модуль **Core** служит фундаментальным слоем приложения, отвечая за сетевые запросы, доступ к базе
данных и общую инфраструктуру для других
модулей. Он предоставляет набор классов и интерфейсов, которые управляют получением данных, их
хранением и преобразованием между различными
слоями приложения.

## Классы и их описание

### 1. **KtorClientProvider**

- **Назначение**: Предоставляет настроенный экземпляр `HttpClient` из библиотеки Ktor для выполнения
  сетевых запросов.
- **Использование**: Используется в репозиториях для выполнения HTTP-запросов к удаленным серверам.
- **Основные настройки**:
    - **Логирование**: Устанавливает логирование с уровнем `LogLevel.ALL` для детального логирования
      всех запросов и ответов.
    - **Content Negotiation**: Настраивает сериализацию и десериализацию JSON с
      помощью `kotlinx.serialization`.
    - **Таймауты**: Задает время ожидания для запросов, подключения и чтения данных.
    - **Обработка исключений**: Обрабатывает распространенные сетевые исключения, такие как
      отсутствие подключения или таймауты.
    - **Валидация ответа**: Проверяет статусы ответов и выбрасывает исключения для ошибок сервера (
      коды 5xx).

### 2. **UrlProvider**

- **Назначение**: Управляет URL-адресами, используемыми для сетевых запросов.
- **Использование**: Предоставляет URL на основе ключа, например, для получения данных вакансий.
- **Функциональность**: Содержит карту URL-адресов и метод `getUrl` для их извлечения.

### 3. **Интерфейсы DAO**

Интерфейсы DAO (Data Access Object) определяют методы для взаимодействия с базой данных SQLite через
библиотеку Room.

#### a. **FavoritesDao**

- **Назначение**: Управляет операциями с избранными вакансиями.
- **Методы**:
    - `upsertItem`: Вставляет или обновляет вакансию в избранном.
    - `getVacancyByIdfromFavorite`: Получает вакансию из избранного по ее ID.
    - `getItemList`: Возвращает поток (`Flow`) списка всех избранных вакансий.
    - `delete`: Удаляет вакансию из избранного.

#### b. **OfferDao**

- **Назначение**: Обрабатывает операции, связанные с предложениями (offers).
- **Методы**:
    - `getAllOffers`: Получает список всех предложений.
    - `getAllOffersFlow`: Получает поток всех предложений.
    - `insertOffers`: Вставляет список предложений в базу данных.

#### c. **VacancyDao**

- **Назначение**: Управляет данными вакансий в базе данных.
- **Методы**:
    - `getVacancyById`: Получает вакансию по ее ID.
    - `getAllVacancies`: Получает список всех вакансий.
    - `getAllVacanciesFlow`: Возвращает поток всех вакансий.
    - `insertVacancies`: Вставляет список вакансий в базу данных.

### 4. **Сущности базы данных**

Эти data-классы представляют таблицы в базе данных Room.

#### a. **FavoriteVacModelDataBase**

- **Назначение**: Представляет избранную вакансию в базе данных.
- **Поля**: Включает информацию о вакансии, такую как `id`, `title`, `company` и другие.
- **Вложенные классы**:
    - `AddressFModelDataBase`
    - `ExperienceFModelDataBase`
    - `SalaryFModelDataBase`

#### b. **OfferModelDataBase**

- **Назначение**: Представляет предложение в базе данных.
- **Поля**: `id`, `title`, `link` и опциональный `button`.
- **Вложенный класс**:
    - `ButtonModDataBase`

#### c. **VacancyModelDataBase**

- **Назначение**: Представляет вакансию в базе данных.
- **Поля**: Аналогичны `FavoriteVacModelDataBase`, но для всех вакансий.
- **Вложенные классы**:
    - `AddressModelDataBase`
    - `ExperienceModelDataBase`
    - `SalaryModelDataBase`

### 5. **AppDatabase**

- **Назначение**: Главный класс базы данных Room, предоставляющий доступ к DAO.
- **Сущности**: Содержит таблицы для вакансий, предложений и избранных вакансий.
- **Методы**:
    - `vacancyDao()`: Возвращает экземпляр `VacancyDao`.
    - `offerDao()`: Возвращает экземпляр `OfferDao`.
    - `favoritesDao()`: Возвращает экземпляр `FavoritesDao`.
- **Особенности**:
    - Использует паттерн Singleton для обеспечения единственного экземпляра базы данных
      через `getDataBase`.

### 6. **Converters**

- **Назначение**: Предоставляет конвертеры типов для Room, позволяя сохранять сложные типы данных,
  такие как списки.
- **Методы**:
    - `fromStringList`: Преобразует строку JSON в список строк.
    - `toStringList`: Преобразует список строк в строку JSON.

### 7. **Сетевые модели данных**

Эти data-классы представляют структуру JSON, получаемую из сети.

- **ResponseOfferAndVacancies**: Содержит списки `offers` и `vacancies`.
- **Offer**, **Button**, **Vacancy**, **Address**, **Experience**, **Salary**: Представляют
  различные части данных вакансий и предложений.

### 8. **VacancyRepositoryImpl**

- **Назначение**: Реализует интерфейс `VacancyRepository` для получения данных из сети.
- **Методы**:
    - `getData`: Выполняет сетевой запрос для получения вакансий и предложений.
- **Особенности**:
    - Обрабатывает различные исключения, связанные с сетевыми запросами, и предоставляет
      информативные сообщения об ошибках.

### 9. **KoinModule**

- **Назначение**: Определяет зависимости для внедрения зависимостей с помощью Koin.
- **Компоненты**:
    - Регистрация `HttpClient`, базы данных `AppDatabase`, DAO, провайдера `KtorClientProvider`,
      репозитория `VacancyRepositoryImpl` и
      use case `GetMappedVacanciesUseCase`.

### 10. **Доменные модели**

Эти классы представляют бизнес-логику приложения.

#### a. **OfferDomainModel**

- **Назначение**: Представляет предложение на доменном уровне.
- **Поля**: `id`, `title`, `link`, опциональный `button`.

#### b. **Button**

- **Назначение**: Представляет кнопку, связанную с предложением.
- **Поле**: `text`.

#### c. **VacancyDomainModel**

- **Назначение**: Представляет вакансию на доменном уровне.
- **Поля**: Включает все необходимые детали вакансии.
- **Вложенные классы**:
    - `AddressDomainModel`
    - `ExperienceDomainModel`
    - `SalaryDomainModel`

### 11. **VacancyRepository**

- **Назначение**: Интерфейс, определяющий контракт для получения данных о вакансиях.
- **Методы**:
    - `getData`: Получает данные о вакансиях и предложениях.

### 12. **GetMappedVacanciesUseCase**

- **Назначение**: Предоставляет методы для получения и преобразования вакансий и предложений в
  доменные модели.
- **Методы**:
    - `getVacancy`: Получает и маппит вакансии.
    - `getOffers`: Получает и маппит предложения.

### 13. **InProgressFragment**

- **Назначение**: Фрагмент, представляющий экран, находящийся в разработке или ожидании реализации.
- **Методы**:
    - `onCreateView`: Инфлейтит макет для фрагмента.

## Взаимодействие классов и рабочий процесс

1. **Получение данных из сети**:

    - `VacancyRepositoryImpl` использует `HttpClient` из `KtorClientProvider` для выполнения
      HTTP-запросов.
    - URL для запросов предоставляются `UrlProvider`.
2. **Обработка и маппинг данных**:

    - Полученные из сети данные (`ResponseOfferAndVacancies`) передаются
      в `GetMappedVacanciesUseCase`.
    - `GetMappedVacanciesUseCase` маппит эти данные в доменные
      модели (`VacancyDomainModel`, `OfferDomainModel`).
3. **Хранение данных в базе данных**:

    - Маппированные данные могут сохраняться в базе данных через соответствующие
      DAO (`VacancyDao`, `OfferDao`, `FavoritesDao`).
    - DAO взаимодействуют с сущностями базы данных (например, `VacancyModelDataBase`).
4. **Предоставление данных в UI**:

    - Другие модули или ViewModel могут использовать `GetMappedVacanciesUseCase` для получения
      данных и предоставления их в UI.
    - Использование `Flow` обеспечивает реактивное обновление UI при изменении данных в базе.
5. **Обработка избранных вакансий**:

    - `FavoritesDao` управляет добавлением и удалением вакансий из избранного.
    - Избранные вакансии хранятся отдельно в базе данных.
6. **Обработка исключений**:

    - `VacancyRepositoryImpl` обрабатывает сетевые исключения и предоставляет информативные
      сообщения для пользователя.
7. **Внедрение зависимостей**:

    - Все зависимости управляются с помощью Koin, что облегчает тестирование и масштабирование
      приложения.

## Использование в приложении

- **Data Layer**: Core-модуль отвечает за получение и хранение данных, предоставляя единый источник
  истины для приложения.
- **Domain Layer**: Доменные модели и use case обеспечивают бизнес-логику приложения.
- **Presentation Layer**: Данные из Core-модуля используются ViewModel и предоставляются во View для
  отображения пользователю.
- **Архитектура**: Применение архитектуры MVVM с использованием Clean Architecture обеспечивает
  разделение ответственности и
- облегчает поддержку и расширение приложения.

## Заключение

Модуль **Core** является ключевым компонентом приложения, обеспечивающим взаимодействие с сетью и
базой данных.
Он использует современные технологии и библиотеки, такие как Ktor для сетевых запросов, Room для
работы с базой данных,
Coroutines и Flow для асинхронного программирования, а также Koin для внедрения зависимостей. Такое
разделение и организация
кода способствуют созданию масштабируемого, тестируемого и поддерживаемого приложения.